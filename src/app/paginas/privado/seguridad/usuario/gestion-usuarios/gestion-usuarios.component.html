<div class="main-content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header card-header-rose card-header-icon">
            <div class="card-icon">
              <i class="material-icons">local_grocery_store</i>
            </div>
            <h4 class="card-title">Nuevo de Ingreso De Usuario</h4>
          </div>
          <div class="card-body">
            <form [formGroup]="frmBusqueda">
              <div class="row">
                <div class="col-md-3">
                  <mat-form-field class="control-full-width" [ngClass]="{'has-danger': TipoDocumentoId?.invalid && (TipoDocumentoId?.dirty || TipoDocumentoId?.touched),
                      'has-success': TipoDocumentoId?.valid && (TipoDocumentoId?.dirty || TipoDocumentoId?.touched)}">
                    <mat-label>TIPO DE DOCUMENTO</mat-label>
                    <mat-select formControlName="TipoDocumentoId" [(ngModel)]="tipoDocumentoIdentidad" (selectionChange)="seleccionarTipoDocumentoIdentidad($event.value)">
                      <mat-option *ngFor="let objTipoDocumento of lstTipoDocumentoIdentidad" [value]="objTipoDocumento.ConjuntoDatoValor">
                        {{objTipoDocumento.ConjuntoDatoTexto}}
                      </mat-option>
                    </mat-select>
                    <mat-error *ngFor="let validacion of mensajesValidacion.TipoDocumento">
                      <mat-error class="error-message" *ngIf="frmBusqueda.get('TipoDocumentoId')?.hasError(validacion.type) && (frmBusqueda.get('TipoDocumentoId')?.dirty || frmBusqueda.get('TipoDocumentoId')?.touched)">{{validacion.message}}</mat-error>
                    </mat-error>
                    <span class="form-control-feedback">
                      <i class="material-icons" *ngIf="TipoDocumentoId?.valid && (TipoDocumentoId?.dirty || TipoDocumentoId?.touched)"></i>
                      <i class="material-icons" *ngIf="TipoDocumentoId?.invalid && (TipoDocumentoId?.dirty || TipoDocumentoId?.touched)"></i>
                    </span>
                  </mat-form-field>
                </div>
                <div class="col-md-3">
                  <mat-form-field class="control-full-width" [ngClass]="{'has-danger': PersonaEmpresaNumeroDocumento?.invalid && (PersonaEmpresaNumeroDocumento?.dirty || PersonaEmpresaNumeroDocumento?.touched),
                      'has-success': PersonaEmpresaNumeroDocumento?.valid && (PersonaEmpresaNumeroDocumento?.dirty || PersonaEmpresaNumeroDocumento?.touched)}">
                    <mat-label>N° Documento</mat-label>
                    <input matInput type="text" onkeypress="return(event.charCode >= 48 && event.charCode <= 57)" (keydown.enter)="buscarPersonaPorTipoNumeroDocumento()" formControlName="PersonaEmpresaNumeroDocumento" maxlength="{{numeroCaracteres}}">
                    <mat-error *ngFor="let validacion of mensajesValidacion.NumeroDocumento">
                      <mat-error class="error-message" *ngIf="frmBusqueda.get('PersonaEmpresaNumeroDocumento')?.hasError(validacion.type) && (frmBusqueda.get('PersonaEmpresaNumeroDocumento')?.dirty || frmBusqueda.get('PersonaEmpresaNumeroDocumento')?.touched)">{{validacion.message}}</mat-error>
                    </mat-error>
                    <span class="form-control-feedback">
                      <i class="material-icons" *ngIf="PersonaEmpresaNumeroDocumento?.valid && (PersonaEmpresaNumeroDocumento?.dirty || PersonaEmpresaNumeroDocumento?.touched)">done</i>
                      <i class="material-icons" *ngIf="PersonaEmpresaNumeroDocumento?.invalid && (PersonaEmpresaNumeroDocumento?.dirty || PersonaEmpresaNumeroDocumento?.touched)">clear</i>
                    </span>
                  </mat-form-field>
                </div>
                <div class="col-md-1">
                  <button type="submit" mat-mini-fab color="primary" (click)="buscarPersonaPorTipoNumeroDocumento()" [disabled]="TipoDocumentoId?.invalid || PersonaEmpresaNumeroDocumento?.invalid">
                    <mat-icon>search</mat-icon>
                  </button>
                </div>
              </div>
            </form>
            {{objPersona.PersonaEmpresaNumeroDocumento}}
            <form [formGroup]="frmPrincipal">
              <div class="row">
                <div class="col-md-4">
                  <mat-form-field class="control-full-width" [ngClass]="{'has-danger': PersonaEmpresaNombre?.invalid,
                      'has-success': PersonaEmpresaNombre?.valid}">
                    <mat-label>Nombre(s)</mat-label>
                    <input matInput formControlName="PersonaEmpresaNombre" type="text" readonly>
                    <span class="form-control-feedback">
                      <i class="material-icons" *ngIf="PersonaEmpresaNombre?.valid">done</i>
                    </span>
                  </mat-form-field>
                </div>
                <div class="col-md-4">
                  <mat-form-field class="control-full-width" [ngClass]="{'has-danger': PersonaEmpresaApellidoPaterno?.invalid,
                      'has-success': PersonaEmpresaApellidoPaterno?.valid}">
                    <mat-label>Apellido Paterno</mat-label>
                    <input matInput formControlName="PersonaEmpresaApellidoPaterno" type="text" readonly>
                    <span class="form-control-feedback">
                      <i class="material-icons" *ngIf="PersonaEmpresaApellidoPaterno?.valid">done</i>
                    </span>
                  </mat-form-field>
                </div>
                <div class="col-md-4">
                  <mat-form-field class="control-full-width" [ngClass]="{'has-danger': PersonaEmpresaApellidoMaterno?.invalid,
                      'has-success': PersonaEmpresaApellidoMaterno?.valid}">
                    <mat-label>Apellido Materno</mat-label>
                    <input matInput formControlName="PersonaEmpresaApellidoMaterno" type="text" readonly>
                    <span class="form-control-feedback">
                      <i class="material-icons" *ngIf="PersonaEmpresaApellidoMaterno?.valid">done</i>
                    </span>
                  </mat-form-field>
                </div>
              </div>
              <div class="row">
                <div class="col-md-3">
                  <mat-form-field class="control-full-width" [ngClass]="{'has-danger': PersonaEmpresaDireccion?.invalid,
                      'has-success': PersonaEmpresaDireccion?.valid}">
                    <mat-label>Dirección</mat-label>
                    <input matInput formControlName="PersonaEmpresaDireccion" type="text">
                    <mat-error *ngFor="let validacion of mensajesValidacion.PersonaEmpresaDireccion">
                      <mat-error class="error-message" *ngIf="frmPrincipal.get('PersonaEmpresaDireccion')?.hasError(validacion.type)">{{validacion.message}}</mat-error>
                    </mat-error>
                    <span class="form-control-feedback">
                      <i class="material-icons" *ngIf="PersonaEmpresaDireccion?.valid">done</i>
                    </span>
                  </mat-form-field>
                </div>
                <div class="col-md-3">
                  <mat-form-field [ngClass]="{'has-danger': PersonaEmpresaCorreo?.invalid,
                      'has-success': PersonaEmpresaCorreo?.valid}">
                    <mat-label>Correo</mat-label>
                    <input matInput type="email" formControlName="PersonaEmpresaCorreo" ng-pattern=" ^[a-z]+[a-z0-9._-]+@[a-z]+\.[a-z.]{2,5}$" required>
                    <mat-error *ngFor="let validacion of mensajesValidacion.PersonaEmpresaCorreo">
                      <mat-error class="error-message" *ngIf="frmPrincipal.get('PersonaEmpresaCorreo')?.hasError(validacion.type)">{{validacion.message}}</mat-error>
                    </mat-error>
                    <span class="form-control-feedback">
                      <i class="material-icons" *ngIf="PersonaEmpresaCorreo?.valid">done</i>
                    </span>
                  </mat-form-field>
                </div>
                <div class="col-md-2">
                  <mat-form-field class="control-full-width" [ngClass]="{'has-danger': PersonaEmpresaFechaNacimiento?.invalid,
                      'has-success': PersonaEmpresaFechaNacimiento?.valid}">
                    <mat-label>Fecha de Nacimiento</mat-label>
                    <input matInput formControlName="PersonaEmpresaFechaNacimiento" type="date">
                  </mat-form-field>
                </div>
                <div class="col-md-2">
                  <mat-form-field class="control-full-width" [ngClass]="{'has-danger': PersonaEmpresaSexo?.invalid && (PersonaEmpresaSexo?.dirty || PersonaEmpresaSexo?.touched),
                      'has-success': PersonaEmpresaSexo?.valid && (PersonaEmpresaSexo?.dirty || PersonaEmpresaSexo?.touched)}">
                    <mat-label>Sexo</mat-label>
                    <mat-select formControlName="PersonaEmpresaSexo">
                      <mat-option *ngFor="let objSexo of lstSexo" [value]="objSexo.ConjuntoDatoValor">
                        {{objSexo.ConjuntoDatoTexto}}
                      </mat-option>
                    </mat-select>
                    <mat-error *ngFor="let validacion of mensajesValidacion.PersonaEmpresaSexo">
                      <mat-error class="error-message" *ngIf="frmBusqueda.get('PersonaEmpresaSexo')?.hasError(validacion.type) && (frmBusqueda.get('PersonaEmpresaSexo')?.dirty || frmBusqueda.get('PersonaEmpresaSexo')?.touched)">{{validacion.message}}</mat-error>
                    </mat-error>
                    <span class="form-control-feedback">
                      <i class="material-icons" *ngIf="PersonaEmpresaSexo?.valid && (PersonaEmpresaSexo?.dirty || PersonaEmpresaSexo?.touched)"></i>
                      <i class="material-icons" *ngIf="PersonaEmpresaSexo?.invalid && (PersonaEmpresaSexo?.dirty || PersonaEmpresaSexo?.touched)"></i>
                    </span>
                  </mat-form-field>
                </div>
                <div class="col-md-2">
                  <mat-form-field class="control-full-width" [ngClass]="{'has-danger': PersonaEmpresaCelular?.invalid,
                      'has-success': PersonaEmpresaCelular?.valid}">
                    <mat-label>N° Celular</mat-label>
                    <input matInput formControlName="PersonaEmpresaCelular" type="text" maxlength="9" onkeypress="return(event.charCode >= 48 && event.charCode <= 57)">
                    <span class="form-control-feedback">
                      <i class="material-icons" *ngIf="PersonaEmpresaCelular?.valid">done</i>
                    </span>
                  </mat-form-field>
                </div>
              </div>
              <div class="row">
                <div class="col-md-2">
                  <mat-form-field class="control-full-width" [ngClass]="{'has-danger': Grupo?.invalid && (Grupo?.dirty || Grupo?.touched),
                      'has-success': Grupo?.valid && (Grupo?.dirty || Grupo?.touched)}">
                    <mat-label>Grupo</mat-label>
                    <mat-select formControlName="Grupo">
                      <mat-option *ngFor="let objGrupo of lstGrupo" [value]="objGrupo.GrupoId">
                        {{objGrupo.GrupoDescripcion}}
                      </mat-option>
                    </mat-select>
                    <mat-error *ngFor="let validacion of mensajesValidacion.Grupo">
                      <mat-error class="error-message" *ngIf="frmPrincipal.get('Grupo')?.hasError(validacion.type) && (frmPrincipal.get('Grupo')?.dirty || frmPrincipal.get('Grupo')?.touched)">{{validacion.message}}</mat-error>
                    </mat-error>
                    <span class="form-control-feedback">
                      <i class="material-icons" *ngIf="Grupo?.valid && (Grupo?.dirty || Grupo?.touched)">hola</i>
                      <i class="material-icons" *ngIf="Grupo?.invalid && (Grupo?.dirty || Grupo?.touched)"><!--clear--></i>
                    </span>
                  </mat-form-field>
                </div>
                <div class="col-md-2">
                  <mat-form-field class="control-full-width" [ngClass]="{'has-danger': PersonaEmpresaEstado?.invalid && (PersonaEmpresaEstado?.dirty || PersonaEmpresaEstado?.touched),
                      'has-success': PersonaEmpresaEstado?.valid && (PersonaEmpresaEstado?.dirty || PersonaEmpresaEstado?.touched)}">
                    <mat-label>Estado</mat-label>
                    <mat-select formControlName="PersonaEmpresaEstado">
                      <mat-option *ngFor="let objEstado of lstEstado" [value]="objEstado.ConjuntoDatoValor">
                        {{objEstado.ConjuntoDatoTexto}}
                      </mat-option>
                    </mat-select>
                    <mat-error *ngFor="let validacion of mensajesValidacion.PersonaEmpresaEstado">
                      <mat-error class="error-message" *ngIf="frmPrincipal.get('PersonaEmpresaEstado')?.hasError(validacion.type) && (frmPrincipal.get('PersonaEmpresaEstado')?.dirty || frmPrincipal.get('PersonaEmpresaEstado')?.touched)">{{validacion.message}}</mat-error>
                    </mat-error>
                  </mat-form-field>
                </div>
                <div class="col-md-2">
                  <mat-form-field class="control-full-width" [ngClass]="{'has-danger': Login?.invalid && (Login?.dirty || Login?.touched),
                      'has-success': Login?.valid && (Login?.dirty || Login?.touched)}">
                    <mat-label>Nombre de usuario</mat-label>
                    <input matInput formControlName="Login" type="text">
                    <mat-error *ngFor="let validacion of mensajesValidacion.Login">
                      <mat-error class="error-message" *ngIf="frmPrincipal.get('Login')?.hasError(validacion.type) && (frmPrincipal.get('Login')?.dirty || frmPrincipal.get('Login')?.touched)">{{validacion.message}}</mat-error>
                    </mat-error>
                    <span class="form-control-feedback">
                      <i class="material-icons" *ngIf="Login?.valid && (Login?.dirty || Login?.touched)">done</i>
                      <i class="material-icons" *ngIf="Login?.invalid && (Login?.dirty || Login?.touched)">clear</i>
                    </span>
                  </mat-form-field>
                </div>
                <div class="col-md-3">
                  <mat-form-field class="control-full-width" [ngClass]="{'has-danger': Password?.invalid && (Password?.dirty || Password?.touched),
                      'has-success': Password?.valid && (Password?.dirty || Password?.touched)}">
                    <mat-label>Contraseña</mat-label>
                    <input matInput formControlName="Password" type="password">
                    <mat-error *ngFor="let validacion of mensajesValidacion.Password">
                      <mat-error class="error-message" *ngIf="frmPrincipal.get('Password')?.hasError(validacion.type) && (frmPrincipal.get('Password')?.dirty || frmPrincipal.get('Password')?.touched)">{{validacion.message}}</mat-error>
                    </mat-error>
                    <span class="form-control-feedback">
                      <i class="material-icons" *ngIf="Password?.valid && (Password?.dirty || Password?.touched)">done</i>
                      <i class="material-icons" *ngIf="Password?.invalid && (Password?.dirty || Password?.touched)">clear</i>
                    </span>
                  </mat-form-field>
                </div>
                <div class="col-md-3">
                  <mat-form-field class="control-full-width" [ngClass]="{'has-danger': RtryPassword?.invalid && (RtryPassword?.dirty || RtryPassword?.touched),
                      'has-success': RtryPassword?.valid && (RtryPassword?.dirty || RtryPassword?.touched)}">
                    <mat-label>Repetir Contraseña</mat-label>
                    <input matInput formControlName="RtryPassword" type="password">
                    <mat-error *ngFor="let validacion of mensajesValidacion.RtryPassword">
                      <mat-error class="error-message" *ngIf="frmPrincipal.get('RtryPassword')?.hasError(validacion.type) && (frmPrincipal.get('RtryPassword')?.dirty || frmPrincipal.get('RtryPassword')?.touched)">{{validacion.message}}</mat-error>
                    </mat-error>
                    <span class="form-control-feedback">
                      <i class="material-icons" *ngIf="RtryPassword?.valid && (RtryPassword?.dirty || RtryPassword?.touched)">done</i>
                      <i class="material-icons" *ngIf="RtryPassword?.invalid && (RtryPassword?.dirty || RtryPassword?.touched)">clear</i>
                    </span>
                  </mat-form-field>
                </div>
              </div>
              <div>
                <hr />
              </div>
              <div class="row">
                <div class="col-md-8">
                  <div class="control-full-width">
                    <div class="row">
                      <div class="col-md-5">
                        <mat-form-field class="control-full-width" [ngClass]="{'has-danger':lstPerfilAgregados.length==0,
                      'has-success': lstPerfilAgregados.length!=0 } ">
                          <mat-label>Perfil</mat-label>
                          <mat-select formControlName="Perfil">
                            <mat-option *ngFor="let objPerfil of lstPerfil" [value]="objPerfil.PerfilId">
                              {{objPerfil.PerfilDescripcion}}
                            </mat-option>
                          </mat-select>
                          <mat-error *ngFor="let validacion of mensajesValidacion.Perfil">
                            <mat-error class="error-message" *ngIf="(frmPrincipal.get('Perfil')?.dirty || frmPrincipal.get('Perfil')?.touched)">{{validacion.message}}</mat-error>
                          </mat-error>
                        </mat-form-field>
                      </div>
                      <div class="col-md-1">
                        <button type="button" mat-mini-fab color="primary" (click)="addPerfil()" title="Guardar Datos" [disabled]="Perfil?.invalid">
                          <mat-icon>add</mat-icon>
                        </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12" *ngIf="lstPerfilAgregados.length>0">
                        <div class="material-datatables">
                          <table id="datatables" class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                            <thead>
                              <tr>
                                <th class="encabezado-tabla perfil">DESCRIPCION DE PERFIL</th>
                                <th class="encabezado-tabla acciones"></th>
                              </tr>
                            </thead>
                            <tbody>
                              <ng-container *ngFor="let objPerfil of lstPerfilAgregados; let indice = index">
                                <tr>
                                  <td>
                                    {{objPerfil.PerfilDescripcion}}
                                  </td>
                                  <td class="celda-derecha">
                                    <button type="button" class="btn btn-link color-secondary" title="Eliminar" matTooltip="Eliminar" (click)="eliminarItem(objPerfil)">
                                      <mat-icon>delete</mat-icon>
                                    </button>
                                  </td>
                                </tr>
                              </ng-container>
                            </tbody>
                            <tfoot>
                              <tr>
                                <td colspan="6">
                                </td>
                              </tr>
                            </tfoot>
                          </table>
                        </div>
                      </div>
                      <div class="col-md-12">
                        <span class="text-danger" *ngIf="lstPerfilAgregados.length==0">
                          No Existen Perfiles Asignados a Este Usuario
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="card-footer">
            <button mat-fab color="secondary" (click)="retroceder()" title="Retroceder">
              <mat-icon>arrow_back</mat-icon>
            </button>
            <button mat-fab color="warn" (click)="guardarDatos(frmPrincipal.value)" [disabled]="frmPrincipal.invalid || lstPerfilAgregados.length==0" title="Guardar Datos">
              <mat-icon>save</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
